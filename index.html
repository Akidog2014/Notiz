function zeigeZusatzMaske() {
  datenAusFormularenSpeichern();
  const heute = new Date().toISOString().split('T')[0];
  document.getElementById('datum').value = heute;

  // Versuche, die Geokoordinaten zu ermitteln
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        document.getElementById('breite').value = position.coords.latitude.toFixed(6);
        document.getElementById('laenge').value = position.coords.longitude.toFixed(6);
        document.getElementById('zusatzMaske').style.display = 'block';
        window.scrollTo(0, document.body.scrollHeight);
      },
      (error) => {
        alert("Standort konnte nicht ermittelt werden: " + error.message);
        document.getElementById('zusatzMaske').style.display = 'block';
        window.scrollTo(0, document.body.scrollHeight);
      }
    );
  } else {
    alert("Geolocation wird von diesem Browser nicht unterstützt.");
    document.getElementById('zusatzMaske').style.display = 'block';
    window.scrollTo(0, document.body.scrollHeight);
  }
}

function finaleMailAbschicken() {
  const zeit = document.getElementById('zeit').value;
  const objekt = document.getElementById('objekt').value;
  const datum = document.getElementById('datum').value;
  const breite = document.getElementById('breite').value;
  const laenge = document.getElementById('laenge').value;

  const empfaenger = "wueest.marc@bluewin.ch"; // <- Anpassen
  const betreff = "Erfasste Personendaten inkl. Objekt und Koordinaten";

  let mailBody = `Datum: ${datum}\nZeit: ${zeit}\nObjekt: ${objekt}\n`;
  mailBody += `Breitengrad: ${breite}\nLängengrad: ${laenge}\n\n`;
  mailBody += `Erfasste Personen:\n\n`;

  alleDaten.forEach((person, index) => {
    mailBody += `Person ${index + 1}:\n`;
    mailBody += `Vorname: ${person.vorname}\n`;
    mailBody += `Nachname: ${person.nachname}\n`;
    mailBody += `Geburtsdatum: ${person.geburtsdatum}\n`;

    if (person.hatZusatz) {
      mailBody += `\n--- Weitere Angaben ---\n`;
      mailBody += `Strasse: ${person.strasse}\n`;
      mailBody += `PLZ: ${person.plz}\n`;
      mailBody += `Ort: ${person.ort}\n`;
      mailBody += `Vater: ${person.vater_vorname} ${person.vater_nachname}\n`;
      mailBody += `Mutter: ${person.mutter_vorname} ${person.mutter_nachname}\n`;
      mailBody += `Geburtsort: ${person.geburtsort}\n`;
      mailBody += `Heimatort: ${person.heimatort}\n`;
    }

    mailBody += `\nArbeitgeber: ${person.arbeitgeber}\n`;
    mailBody += `Beruf: ${person.beruf}\n`;
    mailBody += `Telefonnummer: ${person.telefonnummer}\n\n`;
  });

  const mailtoLink = `mailto:${empfaenger}?subject=${encodeURIComponent(betreff)}&body=${encodeURIComponent(mailBody)}`;
  window.location.href = mailtoLink;
}
